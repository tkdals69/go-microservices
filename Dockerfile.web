FROM golang:1.24 AS builder

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

# 웹 서비스 빌드
RUN go build -o web ./web

FROM alpine:latest

# CA 인증서 설치
RUN apk --no-cache add ca-certificates

WORKDIR /root/

# 빌드된 바이너리 복사
COPY --from=builder /app/web .

# 정적 파일 및 템플릿 복사
COPY --from=builder /app/web/static ./static
COPY --from=builder /app/web/templates ./templates

# 포트 노출
EXPOSE 3003

# 환경변수 기본값
ENV WEB_PORT=3003

# 서비스 실행
CMD ["./web"]
